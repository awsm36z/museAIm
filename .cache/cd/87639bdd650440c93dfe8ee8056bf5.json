{"id":"epB2","dependencies":[{"name":"/Users/yassine/Desktop/VSCODE/museAIm/museAIm/package.json","includedInParent":true,"mtime":1732240580580},{"name":"socket.io-client","loc":{"line":1,"column":19,"index":19},"parent":"/Users/yassine/Desktop/VSCODE/museAIm/museAIm/public/js/main.js","resolved":"/Users/yassine/Desktop/VSCODE/museAIm/museAIm/node_modules/socket.io-client/build/esm/index.js"},{"name":"recorder-js","loc":{"line":2,"column":21,"index":60},"parent":"/Users/yassine/Desktop/VSCODE/museAIm/museAIm/public/js/main.js","resolved":"/Users/yassine/Desktop/VSCODE/museAIm/museAIm/node_modules/recorder-js/index.js"}],"generated":{"js":"\"use strict\";var e=require(\"socket.io-client\"),n=o(require(\"recorder-js\"));function o(e){return e&&e.__esModule?e:{default:e}}var t,i=(0,e.io)(),r=new(window.AudioContext||window.webkitAudioContext),c=new n.default(r,{onAnalysed:function(e){console.log(\"Analysing audio data:\",e)}}),u=-30,a=2e3,d=!1;function s(){c.start().then(function(){console.log(\"Recording started\"),d=!0,f()}).catch(function(e){console.error(\"Failed to start recording:\",e)})}function l(){c.stop().then(function(e){var n=e.blob;console.log(\"Recording stopped, processing data...\");var o=new FileReader;o.onloadend=function(){var e=o.result;console.log(\"Audio buffer size:\",e.byteLength),i.emit(\"audioMessage\",e),console.log(\"Audio buffer sent to server:\",e)},o.readAsArrayBuffer(n)}).catch(function(e){console.error(\"Failed to stop recording:\",e)})}function f(){c.analyse().then(function(e){var n=e.reduce(function(e,n){return e+n},0)/e.length;20*Math.log10(n/255)<u&&d?t||(t=setTimeout(function(){l(),t=null},a)):(clearTimeout(t),t=null),d&&requestAnimationFrame(f)})}function g(e){var n=document.createElement(\"div\");n.textContent=e,document.getElementById(\"messages\").appendChild(n)}document.addEventListener(\"DOMContentLoaded\",function(){var e=document.getElementById(\"voice-button\");e?e.addEventListener(\"click\",function(){console.log(\"Voice button clicked\"),\"suspended\"===r.state&&r.resume().then(function(){console.log(\"AudioContext resumed\")}),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){c.init(e),s()}).catch(function(e){console.error(\"Error accessing the microphone\",e)})}):console.error(\"Voice button not found\")}),i.on(\"botMessage\",function(e){new Audio(\"data:audio/mp3;base64,\".concat(e)).play(),g(\"Agent: [Audio Response]\")});"},"sourceMaps":{"js":{"mappings":[{"source":"main.js","original":{"line":123,"column":0},"generated":{"line":1,"column":0}},{"source":"main.js","original":{"line":1,"column":0},"generated":{"line":1,"column":13}},{"source":"main.js","name":"_socket","original":{"line":1,"column":0},"generated":{"line":1,"column":17}},{"source":"main.js","name":"require","original":{"line":1,"column":0},"generated":{"line":1,"column":19}},{"source":"main.js","original":{"line":1,"column":0},"generated":{"line":1,"column":27}},{"source":"main.js","name":"_recorderJs","original":{"line":2,"column":0},"generated":{"line":1,"column":47}},{"source":"main.js","name":"_interopRequireDefault","original":{"line":2,"column":0},"generated":{"line":1,"column":49}},{"source":"main.js","name":"require","original":{"line":2,"column":0},"generated":{"line":1,"column":51}},{"source":"main.js","original":{"line":2,"column":0},"generated":{"line":1,"column":59}},{"source":"main.js","original":{"line":2,"column":35},"generated":{"line":1,"column":75}},{"source":"main.js","name":"_interopRequireDefault","original":{"line":2,"column":35},"generated":{"line":1,"column":84}},{"source":"main.js","name":"e","original":{"line":2,"column":35},"generated":{"line":1,"column":86}},{"source":"main.js","name":"e","original":{"line":2,"column":35},"generated":{"line":1,"column":89}},{"source":"main.js","name":"e","original":{"line":2,"column":35},"generated":{"line":1,"column":96}},{"source":"main.js","name":"e","original":{"line":2,"column":35},"generated":{"line":1,"column":99}},{"source":"main.js","name":"__esModule","original":{"line":2,"column":35},"generated":{"line":1,"column":101}},{"source":"main.js","name":"e","original":{"line":2,"column":35},"generated":{"line":1,"column":112}},{"source":"main.js","name":"default","original":{"line":2,"column":35},"generated":{"line":1,"column":114}},{"source":"main.js","name":"default","original":{"line":2,"column":35},"generated":{"line":1,"column":115}},{"source":"main.js","name":"e","original":{"line":2,"column":35},"generated":{"line":1,"column":123}},{"source":"main.js","original":{"line":4,"column":0},"generated":{"line":1,"column":126}},{"source":"main.js","name":"silenceTimeout","original":{"line":16,"column":4},"generated":{"line":1,"column":130}},{"source":"main.js","name":"socket","original":{"line":4,"column":6},"generated":{"line":1,"column":132}},{"source":"main.js","original":{"line":4,"column":15},"generated":{"line":1,"column":135}},{"source":"main.js","name":"io","original":{"line":4,"column":15},"generated":{"line":1,"column":137}},{"source":"main.js","original":{"line":4,"column":17},"generated":{"line":1,"column":139}},{"source":"main.js","name":"audioContext","original":{"line":7,"column":4},"generated":{"line":1,"column":145}},{"source":"main.js","original":{"line":7,"column":19},"generated":{"line":1,"column":147}},{"source":"main.js","name":"window","original":{"line":7,"column":24},"generated":{"line":1,"column":151}},{"source":"main.js","name":"AudioContext","original":{"line":7,"column":31},"generated":{"line":1,"column":158}},{"source":"main.js","name":"window","original":{"line":7,"column":47},"generated":{"line":1,"column":172}},{"source":"main.js","name":"webkitAudioContext","original":{"line":7,"column":54},"generated":{"line":1,"column":179}},{"source":"main.js","name":"recorder","original":{"line":8,"column":4},"generated":{"line":1,"column":199}},{"source":"main.js","original":{"line":8,"column":15},"generated":{"line":1,"column":201}},{"source":"main.js","name":"Recorder","original":{"line":8,"column":19},"generated":{"line":1,"column":205}},{"source":"main.js","original":{"line":8,"column":27},"generated":{"line":1,"column":207}},{"source":"main.js","name":"audioContext","original":{"line":8,"column":28},"generated":{"line":1,"column":215}},{"source":"main.js","original":{"line":8,"column":42},"generated":{"line":1,"column":217}},{"source":"main.js","name":"onAnalysed","original":{"line":9,"column":4},"generated":{"line":1,"column":218}},{"source":"main.js","original":{"line":9,"column":16},"generated":{"line":1,"column":229}},{"source":"main.js","name":"data","original":{"line":9,"column":16},"generated":{"line":1,"column":238}},{"source":"main.js","name":"console","original":{"line":10,"column":8},"generated":{"line":1,"column":241}},{"source":"main.js","name":"log","original":{"line":10,"column":16},"generated":{"line":1,"column":249}},{"source":"main.js","original":{"line":10,"column":20},"generated":{"line":1,"column":253}},{"source":"main.js","name":"data","original":{"line":10,"column":45},"generated":{"line":1,"column":277}},{"source":"main.js","name":"silenceThreshold","original":{"line":15,"column":4},"generated":{"line":1,"column":283}},{"source":"main.js","original":{"line":15,"column":24},"generated":{"line":1,"column":286}},{"source":"main.js","name":"silenceDuration","original":{"line":17,"column":6},"generated":{"line":1,"column":289}},{"source":"main.js","original":{"line":17,"column":24},"generated":{"line":1,"column":291}},{"source":"main.js","name":"isRecording","original":{"line":18,"column":4},"generated":{"line":1,"column":295}},{"source":"main.js","original":{"line":18,"column":18},"generated":{"line":1,"column":298}},{"source":"main.js","original":{"line":51,"column":0},"generated":{"line":1,"column":300}},{"source":"main.js","name":"startRecording","original":{"line":51,"column":9},"generated":{"line":1,"column":309}},{"source":"main.js","name":"recorder","original":{"line":52,"column":4},"generated":{"line":1,"column":313}},{"source":"main.js","name":"start","original":{"line":52,"column":13},"generated":{"line":1,"column":315}},{"source":"main.js","name":"then","original":{"line":53,"column":9},"generated":{"line":1,"column":323}},{"source":"main.js","original":{"line":53,"column":14},"generated":{"line":1,"column":328}},{"source":"main.js","name":"console","original":{"line":54,"column":12},"generated":{"line":1,"column":339}},{"source":"main.js","name":"log","original":{"line":54,"column":20},"generated":{"line":1,"column":347}},{"source":"main.js","original":{"line":54,"column":24},"generated":{"line":1,"column":351}},{"source":"main.js","name":"isRecording","original":{"line":55,"column":12},"generated":{"line":1,"column":372}},{"source":"main.js","original":{"line":55,"column":26},"generated":{"line":1,"column":375}},{"source":"main.js","name":"monitorSilence","original":{"line":56,"column":12},"generated":{"line":1,"column":377}},{"source":"main.js","name":"catch","original":{"line":58,"column":9},"generated":{"line":1,"column":383}},{"source":"main.js","original":{"line":58,"column":15},"generated":{"line":1,"column":389}},{"source":"main.js","name":"error","original":{"line":58,"column":15},"generated":{"line":1,"column":398}},{"source":"main.js","name":"console","original":{"line":59,"column":12},"generated":{"line":1,"column":401}},{"source":"main.js","name":"error","original":{"line":59,"column":20},"generated":{"line":1,"column":409}},{"source":"main.js","original":{"line":59,"column":26},"generated":{"line":1,"column":415}},{"source":"main.js","name":"error","original":{"line":59,"column":56},"generated":{"line":1,"column":444}},{"source":"main.js","original":{"line":64,"column":0},"generated":{"line":1,"column":449}},{"source":"main.js","name":"stopRecording","original":{"line":64,"column":9},"generated":{"line":1,"column":458}},{"source":"main.js","name":"recorder","original":{"line":65,"column":4},"generated":{"line":1,"column":462}},{"source":"main.js","name":"stop","original":{"line":65,"column":13},"generated":{"line":1,"column":464}},{"source":"main.js","name":"then","original":{"line":66,"column":9},"generated":{"line":1,"column":471}},{"source":"main.js","original":{"line":66,"column":14},"generated":{"line":1,"column":476}},{"source":"main.js","name":"_ref","original":{"line":66,"column":14},"generated":{"line":1,"column":485}},{"source":"main.js","original":{"line":66,"column":28},"generated":{"line":1,"column":488}},{"source":"main.js","name":"blob","original":{"line":66,"column":17},"generated":{"line":1,"column":492}},{"source":"main.js","name":"_ref","original":{"line":66,"column":21},"generated":{"line":1,"column":494}},{"source":"main.js","name":"blob","original":{"line":66,"column":17},"generated":{"line":1,"column":496}},{"source":"main.js","name":"console","original":{"line":67,"column":12},"generated":{"line":1,"column":501}},{"source":"main.js","name":"log","original":{"line":67,"column":20},"generated":{"line":1,"column":509}},{"source":"main.js","original":{"line":67,"column":24},"generated":{"line":1,"column":513}},{"source":"main.js","original":{"line":68,"column":12},"generated":{"line":1,"column":554}},{"source":"main.js","name":"reader","original":{"line":68,"column":18},"generated":{"line":1,"column":558}},{"source":"main.js","original":{"line":68,"column":27},"generated":{"line":1,"column":560}},{"source":"main.js","name":"FileReader","original":{"line":68,"column":31},"generated":{"line":1,"column":564}},{"source":"main.js","name":"reader","original":{"line":70,"column":12},"generated":{"line":1,"column":575}},{"source":"main.js","name":"onloadend","original":{"line":70,"column":19},"generated":{"line":1,"column":577}},{"source":"main.js","original":{"line":70,"column":31},"generated":{"line":1,"column":587}},{"source":"main.js","original":{"line":71,"column":16},"generated":{"line":1,"column":598}},{"source":"main.js","name":"audioBuffer","original":{"line":71,"column":22},"generated":{"line":1,"column":602}},{"source":"main.js","name":"reader","original":{"line":71,"column":36},"generated":{"line":1,"column":604}},{"source":"main.js","name":"result","original":{"line":71,"column":43},"generated":{"line":1,"column":606}},{"source":"main.js","name":"console","original":{"line":72,"column":16},"generated":{"line":1,"column":613}},{"source":"main.js","name":"log","original":{"line":72,"column":24},"generated":{"line":1,"column":621}},{"source":"main.js","original":{"line":72,"column":28},"generated":{"line":1,"column":625}},{"source":"main.js","name":"audioBuffer","original":{"line":72,"column":50},"generated":{"line":1,"column":646}},{"source":"main.js","name":"byteLength","original":{"line":72,"column":62},"generated":{"line":1,"column":648}},{"source":"main.js","name":"socket","original":{"line":75,"column":16},"generated":{"line":1,"column":660}},{"source":"main.js","name":"emit","original":{"line":75,"column":23},"generated":{"line":1,"column":662}},{"source":"main.js","original":{"line":75,"column":28},"generated":{"line":1,"column":667}},{"source":"main.js","name":"audioBuffer","original":{"line":75,"column":44},"generated":{"line":1,"column":682}},{"source":"main.js","name":"console","original":{"line":76,"column":16},"generated":{"line":1,"column":685}},{"source":"main.js","name":"log","original":{"line":76,"column":24},"generated":{"line":1,"column":693}},{"source":"main.js","original":{"line":76,"column":28},"generated":{"line":1,"column":697}},{"source":"main.js","name":"audioBuffer","original":{"line":76,"column":60},"generated":{"line":1,"column":728}},{"source":"main.js","name":"reader","original":{"line":79,"column":12},"generated":{"line":1,"column":732}},{"source":"main.js","name":"readAsArrayBuffer","original":{"line":79,"column":19},"generated":{"line":1,"column":734}},{"source":"main.js","name":"blob","original":{"line":79,"column":37},"generated":{"line":1,"column":752}},{"source":"main.js","name":"catch","original":{"line":81,"column":9},"generated":{"line":1,"column":757}},{"source":"main.js","original":{"line":81,"column":15},"generated":{"line":1,"column":763}},{"source":"main.js","name":"error","original":{"line":81,"column":15},"generated":{"line":1,"column":772}},{"source":"main.js","name":"console","original":{"line":82,"column":12},"generated":{"line":1,"column":775}},{"source":"main.js","name":"error","original":{"line":82,"column":20},"generated":{"line":1,"column":783}},{"source":"main.js","original":{"line":82,"column":26},"generated":{"line":1,"column":789}},{"source":"main.js","name":"error","original":{"line":82,"column":55},"generated":{"line":1,"column":817}},{"source":"main.js","original":{"line":87,"column":0},"generated":{"line":1,"column":822}},{"source":"main.js","name":"monitorSilence","original":{"line":87,"column":9},"generated":{"line":1,"column":831}},{"source":"main.js","name":"recorder","original":{"line":88,"column":4},"generated":{"line":1,"column":835}},{"source":"main.js","name":"analyse","original":{"line":88,"column":13},"generated":{"line":1,"column":837}},{"source":"main.js","name":"then","original":{"line":89,"column":9},"generated":{"line":1,"column":847}},{"source":"main.js","original":{"line":89,"column":14},"generated":{"line":1,"column":852}},{"source":"main.js","name":"data","original":{"line":89,"column":14},"generated":{"line":1,"column":861}},{"source":"main.js","original":{"line":90,"column":12},"generated":{"line":1,"column":864}},{"source":"main.js","name":"average","original":{"line":90,"column":18},"generated":{"line":1,"column":868}},{"source":"main.js","name":"data","original":{"line":90,"column":28},"generated":{"line":1,"column":870}},{"source":"main.js","name":"reduce","original":{"line":90,"column":33},"generated":{"line":1,"column":872}},{"source":"main.js","original":{"line":90,"column":40},"generated":{"line":1,"column":879}},{"source":"main.js","name":"sum","original":{"line":90,"column":41},"generated":{"line":1,"column":888}},{"source":"main.js","name":"value","original":{"line":90,"column":46},"generated":{"line":1,"column":890}},{"source":"main.js","original":{"line":90,"column":51},"generated":{"line":1,"column":893}},{"source":"main.js","name":"sum","original":{"line":90,"column":56},"generated":{"line":1,"column":900}},{"source":"main.js","name":"value","original":{"line":90,"column":62},"generated":{"line":1,"column":902}},{"source":"main.js","original":{"line":90,"column":69},"generated":{"line":1,"column":905}},{"source":"main.js","name":"data","original":{"line":90,"column":74},"generated":{"line":1,"column":908}},{"source":"main.js","name":"length","original":{"line":90,"column":79},"generated":{"line":1,"column":910}},{"source":"main.js","original":{"line":91,"column":29},"generated":{"line":1,"column":917}},{"source":"main.js","name":"Math","original":{"line":91,"column":34},"generated":{"line":1,"column":920}},{"source":"main.js","name":"log10","original":{"line":91,"column":39},"generated":{"line":1,"column":925}},{"source":"main.js","name":"average","original":{"line":91,"column":45},"generated":{"line":1,"column":931}},{"source":"main.js","original":{"line":91,"column":55},"generated":{"line":1,"column":933}},{"source":"main.js","name":"silenceThreshold","original":{"line":93,"column":27},"generated":{"line":1,"column":938}},{"source":"main.js","name":"isRecording","original":{"line":93,"column":47},"generated":{"line":1,"column":941}},{"source":"main.js","name":"silenceTimeout","original":{"line":94,"column":21},"generated":{"line":1,"column":943}},{"source":"main.js","name":"silenceTimeout","original":{"line":95,"column":20},"generated":{"line":1,"column":947}},{"source":"main.js","name":"setTimeout","original":{"line":95,"column":37},"generated":{"line":1,"column":949}},{"source":"main.js","original":{"line":95,"column":48},"generated":{"line":1,"column":960}},{"source":"main.js","name":"stopRecording","original":{"line":96,"column":24},"generated":{"line":1,"column":971}},{"source":"main.js","name":"silenceTimeout","original":{"line":97,"column":24},"generated":{"line":1,"column":975}},{"source":"main.js","original":{"line":97,"column":41},"generated":{"line":1,"column":977}},{"source":"main.js","name":"silenceDuration","original":{"line":98,"column":23},"generated":{"line":1,"column":983}},{"source":"main.js","name":"clearTimeout","original":{"line":101,"column":16},"generated":{"line":1,"column":988}},{"source":"main.js","name":"silenceTimeout","original":{"line":101,"column":29},"generated":{"line":1,"column":1001}},{"source":"main.js","name":"silenceTimeout","original":{"line":102,"column":16},"generated":{"line":1,"column":1004}},{"source":"main.js","original":{"line":102,"column":33},"generated":{"line":1,"column":1006}},{"source":"main.js","name":"isRecording","original":{"line":105,"column":16},"generated":{"line":1,"column":1012}},{"source":"main.js","name":"requestAnimationFrame","original":{"line":106,"column":16},"generated":{"line":1,"column":1015}},{"source":"main.js","name":"monitorSilence","original":{"line":106,"column":38},"generated":{"line":1,"column":1037}},{"source":"main.js","original":{"line":119,"column":0},"generated":{"line":1,"column":1042}},{"source":"main.js","name":"appendMessage","original":{"line":119,"column":9},"generated":{"line":1,"column":1051}},{"source":"main.js","name":"message","original":{"line":119,"column":23},"generated":{"line":1,"column":1053}},{"source":"main.js","original":{"line":120,"column":4},"generated":{"line":1,"column":1056}},{"source":"main.js","name":"messageElement","original":{"line":120,"column":10},"generated":{"line":1,"column":1060}},{"source":"main.js","name":"document","original":{"line":120,"column":27},"generated":{"line":1,"column":1062}},{"source":"main.js","name":"createElement","original":{"line":120,"column":36},"generated":{"line":1,"column":1071}},{"source":"main.js","original":{"line":120,"column":50},"generated":{"line":1,"column":1085}},{"source":"main.js","name":"messageElement","original":{"line":121,"column":4},"generated":{"line":1,"column":1092}},{"source":"main.js","name":"textContent","original":{"line":121,"column":19},"generated":{"line":1,"column":1094}},{"source":"main.js","name":"message","original":{"line":121,"column":33},"generated":{"line":1,"column":1106}},{"source":"main.js","name":"document","original":{"line":122,"column":4},"generated":{"line":1,"column":1108}},{"source":"main.js","name":"getElementById","original":{"line":122,"column":13},"generated":{"line":1,"column":1117}},{"source":"main.js","original":{"line":122,"column":28},"generated":{"line":1,"column":1132}},{"source":"main.js","name":"appendChild","original":{"line":122,"column":40},"generated":{"line":1,"column":1144}},{"source":"main.js","name":"messageElement","original":{"line":122,"column":52},"generated":{"line":1,"column":1156}},{"source":"main.js","name":"document","original":{"line":20,"column":0},"generated":{"line":1,"column":1159}},{"source":"main.js","name":"addEventListener","original":{"line":20,"column":9},"generated":{"line":1,"column":1168}},{"source":"main.js","original":{"line":20,"column":26},"generated":{"line":1,"column":1185}},{"source":"main.js","original":{"line":20,"column":46},"generated":{"line":1,"column":1204}},{"source":"main.js","original":{"line":21,"column":4},"generated":{"line":1,"column":1215}},{"source":"main.js","name":"voiceButton","original":{"line":21,"column":10},"generated":{"line":1,"column":1219}},{"source":"main.js","name":"document","original":{"line":21,"column":24},"generated":{"line":1,"column":1221}},{"source":"main.js","name":"getElementById","original":{"line":21,"column":33},"generated":{"line":1,"column":1230}},{"source":"main.js","original":{"line":21,"column":48},"generated":{"line":1,"column":1245}},{"source":"main.js","name":"voiceButton","original":{"line":23,"column":9},"generated":{"line":1,"column":1261}},{"source":"main.js","name":"voiceButton","original":{"line":28,"column":4},"generated":{"line":1,"column":1263}},{"source":"main.js","name":"addEventListener","original":{"line":28,"column":16},"generated":{"line":1,"column":1265}},{"source":"main.js","original":{"line":28,"column":33},"generated":{"line":1,"column":1282}},{"source":"main.js","original":{"line":28,"column":42},"generated":{"line":1,"column":1290}},{"source":"main.js","name":"console","original":{"line":29,"column":8},"generated":{"line":1,"column":1301}},{"source":"main.js","name":"log","original":{"line":29,"column":16},"generated":{"line":1,"column":1309}},{"source":"main.js","original":{"line":29,"column":20},"generated":{"line":1,"column":1313}},{"source":"main.js","original":{"line":32,"column":35},"generated":{"line":1,"column":1337}},{"source":"main.js","name":"audioContext","original":{"line":32,"column":12},"generated":{"line":1,"column":1351}},{"source":"main.js","name":"state","original":{"line":32,"column":25},"generated":{"line":1,"column":1353}},{"source":"main.js","name":"audioContext","original":{"line":33,"column":12},"generated":{"line":1,"column":1360}},{"source":"main.js","name":"resume","original":{"line":33,"column":25},"generated":{"line":1,"column":1362}},{"source":"main.js","name":"then","original":{"line":33,"column":34},"generated":{"line":1,"column":1371}},{"source":"main.js","original":{"line":33,"column":39},"generated":{"line":1,"column":1376}},{"source":"main.js","name":"console","original":{"line":34,"column":16},"generated":{"line":1,"column":1387}},{"source":"main.js","name":"log","original":{"line":34,"column":24},"generated":{"line":1,"column":1395}},{"source":"main.js","original":{"line":34,"column":28},"generated":{"line":1,"column":1399}},{"source":"main.js","name":"navigator","original":{"line":39,"column":8},"generated":{"line":1,"column":1425}},{"source":"main.js","name":"mediaDevices","original":{"line":39,"column":18},"generated":{"line":1,"column":1435}},{"source":"main.js","name":"getUserMedia","original":{"line":39,"column":31},"generated":{"line":1,"column":1448}},{"source":"main.js","original":{"line":39,"column":44},"generated":{"line":1,"column":1461}},{"source":"main.js","name":"audio","original":{"line":39,"column":46},"generated":{"line":1,"column":1462}},{"source":"main.js","original":{"line":39,"column":53},"generated":{"line":1,"column":1469}},{"source":"main.js","name":"then","original":{"line":40,"column":13},"generated":{"line":1,"column":1473}},{"source":"main.js","original":{"line":40,"column":18},"generated":{"line":1,"column":1478}},{"source":"main.js","name":"stream","original":{"line":40,"column":18},"generated":{"line":1,"column":1487}},{"source":"main.js","name":"recorder","original":{"line":41,"column":16},"generated":{"line":1,"column":1490}},{"source":"main.js","name":"init","original":{"line":41,"column":25},"generated":{"line":1,"column":1492}},{"source":"main.js","name":"stream","original":{"line":41,"column":30},"generated":{"line":1,"column":1497}},{"source":"main.js","name":"startRecording","original":{"line":42,"column":16},"generated":{"line":1,"column":1500}},{"source":"main.js","name":"catch","original":{"line":44,"column":13},"generated":{"line":1,"column":1506}},{"source":"main.js","original":{"line":44,"column":19},"generated":{"line":1,"column":1512}},{"source":"main.js","name":"error","original":{"line":44,"column":19},"generated":{"line":1,"column":1521}},{"source":"main.js","name":"console","original":{"line":45,"column":16},"generated":{"line":1,"column":1524}},{"source":"main.js","name":"error","original":{"line":45,"column":24},"generated":{"line":1,"column":1532}},{"source":"main.js","original":{"line":45,"column":30},"generated":{"line":1,"column":1538}},{"source":"main.js","name":"error","original":{"line":45,"column":64},"generated":{"line":1,"column":1571}},{"source":"main.js","name":"console","original":{"line":24,"column":8},"generated":{"line":1,"column":1578}},{"source":"main.js","name":"error","original":{"line":24,"column":16},"generated":{"line":1,"column":1586}},{"source":"main.js","original":{"line":24,"column":22},"generated":{"line":1,"column":1592}},{"source":"main.js","name":"socket","original":{"line":112,"column":0},"generated":{"line":1,"column":1620}},{"source":"main.js","name":"on","original":{"line":112,"column":7},"generated":{"line":1,"column":1622}},{"source":"main.js","original":{"line":112,"column":10},"generated":{"line":1,"column":1625}},{"source":"main.js","original":{"line":112,"column":24},"generated":{"line":1,"column":1638}},{"source":"main.js","name":"audioBase64","original":{"line":112,"column":25},"generated":{"line":1,"column":1647}},{"source":"main.js","original":{"line":113,"column":18},"generated":{"line":1,"column":1650}},{"source":"main.js","name":"Audio","original":{"line":113,"column":22},"generated":{"line":1,"column":1654}},{"source":"main.js","name":"concat","original":{"line":113,"column":27},"generated":{"line":1,"column":1660}},{"source":"main.js","name":"concat","original":{"line":113,"column":27},"generated":{"line":1,"column":1685}},{"source":"main.js","name":"audioBase64","original":{"line":113,"column":53},"generated":{"line":1,"column":1692}},{"source":"main.js","name":"play","original":{"line":114,"column":10},"generated":{"line":1,"column":1696}},{"source":"main.js","name":"appendMessage","original":{"line":115,"column":4},"generated":{"line":1,"column":1703}},{"source":"main.js","original":{"line":115,"column":43},"generated":{"line":1,"column":1705}}],"sources":{"main.js":"import { io } from \"socket.io-client\";\nimport Recorder from \"recorder-js\";\n\nconst socket = io();\n\n// Create the audio context and the recorder instance\nlet audioContext = new (window.AudioContext || window.webkitAudioContext)();\nlet recorder = new Recorder(audioContext, {\n    onAnalysed: data => {\n        console.log('Analysing audio data:', data);\n    }\n});\n\n// Monitor silence (threshold in dB)\nlet silenceThreshold = -30;\nlet silenceTimeout;\nconst silenceDuration = 2000; // 2 seconds\nlet isRecording = false;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    const voiceButton = document.getElementById('voice-button');\n\n    if (!voiceButton) {\n        console.error('Voice button not found');\n        return;\n    }\n\n    voiceButton.addEventListener('click', () => {\n        console.log('Voice button clicked');\n\n        // Start the audio context if suspended\n        if (audioContext.state === 'suspended') {\n            audioContext.resume().then(() => {\n                console.log('AudioContext resumed');\n            });\n        }\n\n        // Access the microphone\n        navigator.mediaDevices.getUserMedia({ audio: true })\n            .then(stream => {\n                recorder.init(stream);\n                startRecording();\n            })\n            .catch(error => {\n                console.error('Error accessing the microphone', error);\n            });\n    });\n});\n\n// Start recording\nfunction startRecording() {\n    recorder.start()\n        .then(() => {\n            console.log('Recording started');\n            isRecording = true;\n            monitorSilence();\n        })\n        .catch(error => {\n            console.error('Failed to start recording:', error);\n        });\n}\n\n// Stop recording and handle the data\nfunction stopRecording() {\n    recorder.stop()\n        .then(({ blob }) => {\n            console.log('Recording stopped, processing data...');\n            const reader = new FileReader();\n\n            reader.onloadend = () => {\n                const audioBuffer = reader.result;\n                console.log('Audio buffer size:', audioBuffer.byteLength);\n\n                // Send audioBuffer to server via WebSocket\n                socket.emit('audioMessage', audioBuffer);\n                console.log('Audio buffer sent to server:', audioBuffer);\n            };\n\n            reader.readAsArrayBuffer(blob); // Convert blob to ArrayBuffer\n        })\n        .catch(error => {\n            console.error('Failed to stop recording:', error);\n        });\n}\n\n// Monitor for silence and auto-stop recording\nfunction monitorSilence() {\n    recorder.analyse()\n        .then(data => {\n            const average = data.reduce((sum, value) => sum + value, 0) / data.length;\n            const decibels = 20 * Math.log10(average / 255);\n\n            if (decibels < silenceThreshold && isRecording) {\n                if (!silenceTimeout) {\n                    silenceTimeout = setTimeout(() => {\n                        stopRecording();\n                        silenceTimeout = null;\n                    }, silenceDuration);\n                }\n            } else {\n                clearTimeout(silenceTimeout);\n                silenceTimeout = null;\n            }\n\n            if (isRecording) {\n                requestAnimationFrame(monitorSilence); // Continue monitoring\n            }\n        });\n}\n\n// Listen for bot's audio response from the server\nsocket.on('botMessage', (audioBase64) => {\n    const audio = new Audio(`data:audio/mp3;base64,${audioBase64}`);\n    audio.play();\n    appendMessage(`Agent: [Audio Response]`);\n});\n\n// Append messages to the chat window\nfunction appendMessage(message) {\n    const messageElement = document.createElement('div');\n    messageElement.textContent = message;\n    document.getElementById('messages').appendChild(messageElement);\n}\n"},"lineCount":null}},"error":null,"hash":"9e6a85a33e3684b03440c6dedb5fb025","cacheData":{"env":{}}}